# Nepgear

**Nepgear** æ˜¯ä¸€ä¸ªä¸“ä¸ºæ—¥è¯­ Galgameï¼ˆè§†è§‰å°è¯´ï¼‰è®¾è®¡çš„é€šç”¨ DLL åŠ«æŒä¸ Hook æ¡†æ¶ã€‚

é€šè¿‡åŠ«æŒç³»ç»Ÿ DLLï¼ˆé»˜è®¤ `winmm.dll`ï¼‰ï¼ŒNepgear å¯ä»¥è‡ªåŠ¨éšæ¸¸æˆå¯åŠ¨ï¼Œå¹¶æä¾›åŒºåŸŸæ¨¡æ‹Ÿã€å­—ä½“æ›¿æ¢ã€æ–‡ä»¶é‡å®šå‘ç­‰å¼ºå¤§åŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **DLL åŠ«æŒåŠ è½½**ï¼šåˆ©ç”¨ `winmm.dll` ä»£ç†æŠ€æœ¯ï¼Œæ— éœ€ä¿®æ”¹æ¸¸æˆåŸæœ‰å¯æ‰§è¡Œæ–‡ä»¶å³å¯è‡ªåŠ¨åŠ è½½ã€‚
*   **åŒºåŸŸæ¨¡æ‹Ÿ (Locale Emulator)**ï¼š
    *   å†…ç½®åŒºåŸŸæ¨¡æ‹ŸåŠŸèƒ½ï¼Œå¯åœ¨éæ—¥è¯­ç³»ç»Ÿä¸Šç›´æ¥è¿è¡Œ Shift-JIS ç¼–ç çš„æ—¥è¯­æ¸¸æˆã€‚
    *   æ”¯æŒæ¨¡æ‹Ÿ Shift-JIS (932) æˆ– GBK (936) ç¯å¢ƒã€‚
*   **é«˜çº§å­—ä½“æŒ‚é’© (Font Hook)**ï¼š
    *   åŠ¨æ€æ›¿æ¢æ¸¸æˆå­—ä½“ï¼ˆé»˜è®¤ `galgame_cnjp.ttf`ï¼‰ã€‚
    *   æ”¯æŒè‡ªå®šä¹‰å­—ä½“å¤§å°ç¼©æ”¾ï¼ˆå®½é«˜æ¯”è°ƒæ•´ï¼‰ã€‚
    *   æ”¯æŒå­—ä½“ç²—ç»†è°ƒæ•´ã€‚
    *   å¼ºåˆ¶æŒ‡å®šå­—ç¬¦é›†ï¼ˆè§£å†³ä¹±ç é—®é¢˜ï¼‰ã€‚
*   **çª—å£æ ‡é¢˜ä¿®æ”¹**ï¼šè‡ªå®šä¹‰æ¸¸æˆçª—å£æ ‡é¢˜ï¼Œæ”¯æŒ Unicodeã€‚
*   **è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ (VFS) & æ–‡ä»¶é‡å®šå‘**ï¼š
    *   å°†æ¸¸æˆè¯»å–çš„æ–‡ä»¶é‡å®šå‘åˆ°å¤–éƒ¨æ–‡ä»¶å¤¹ï¼ˆå¦‚ `Nepgear/`ï¼‰ã€‚
    *   æ”¯æŒè¯»å–æ‰“åŒ…çš„ `.chs` èµ„æºåŒ…ï¼ˆç±»ä¼¼å°åŒ…æ±‰åŒ–ï¼‰ã€‚
    *   ä¼˜å…ˆè¯»å–å¤–éƒ¨æ–‡ä»¶ï¼Œæ–¹ä¾¿æ›¿æ¢æ¸¸æˆèµ„æºï¼ˆå›¾ç‰‡ã€è„šæœ¬ç­‰ï¼‰ã€‚

## ğŸ› ï¸ æ„å»ºæŒ‡å—

### ç¯å¢ƒè¦æ±‚
*   Visual Studio 2022 (v143 å·¥å…·é›†)
*   Windows SDK

### ç¼–è¯‘æ­¥éª¤
1.  ä½¿ç”¨ Visual Studio 2022 æ‰“å¼€ `Nepgear.sln`ã€‚
2.  é€‰æ‹©æ„å»ºé…ç½®ä¸º `Release` / `x86` (å¤§å¤šæ•° Galgame ä¸º 32 ä½ç¨‹åº)ã€‚
3.  ç‚¹å‡» **ç”Ÿæˆè§£å†³æ–¹æ¡ˆ (Build Solution)**ã€‚
4.  ç¼–è¯‘å®Œæˆåï¼š
    *   åœ¨ `Release/` ç›®å½•ä¸‹ä¼šç”Ÿæˆ `Nepgear.dll`ã€‚
    *   åœ¨ `Packer/Release/` (æˆ–ç±»ä¼¼è·¯å¾„) ä¸‹ä¼šç”Ÿæˆ `Packer.exe`ã€‚

## ğŸ“¦ å®‰è£…ä¸ä½¿ç”¨

### 1. éƒ¨ç½²æ–‡ä»¶
å°†ä»¥ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼ˆå³æ¸¸æˆä¸» EXE æ‰€åœ¨çš„ç›®å½•ï¼‰ï¼š

1.  **Nepgear.dll** -> é‡å‘½åä¸º **`winmm.dll`**ã€‚ï¼ˆæˆ–ç›´æ¥åœ¨VSé‡Œè®¾ç½®ç›®æ ‡æ–‡ä»¶åä¸ºwinmmï¼‰
    *   *åŸç†ï¼šæ¸¸æˆå¯åŠ¨æ—¶ä¼šå°è¯•åŠ è½½ç³»ç»Ÿçš„ winmm.dllï¼Œé‡å‘½ååæ¸¸æˆä¼šä¼˜å…ˆåŠ è½½æˆ‘ä»¬çš„ DLLï¼ŒNepgear ä¼šè‡ªåŠ¨å°†åŸæœ‰å‡½æ•°è°ƒç”¨è½¬å‘ç»™ç³»ç»ŸçœŸæ­£çš„ winmm.dllã€‚*
2.  **Nepgear.ini** -> é…ç½®æ–‡ä»¶ã€‚
3.  **galgame_cnjp.ttf** -> ä½ æƒ³è¦æ›¿æ¢çš„å­—ä½“æ–‡ä»¶ï¼ˆæ–‡ä»¶åéœ€ä¸ ini ä¸­é…ç½®ä¸€è‡´ï¼‰ã€‚

### 2. é…ç½®æ–‡ä»¶è¯´æ˜ (Nepgear.ini)
é…ç½®æ–‡ä»¶éœ€ä¿å­˜ä¸º **UTF-16 LE** ç¼–ç ã€‚

```ini
[System]
; å…¨å±€å¼€å…³ï¼Œè®¾ä¸º 0 å°†ç¦ç”¨æ‰€æœ‰åŠŸèƒ½
Enable=1

[Font]
; æ˜¯å¦å¯ç”¨å­—ä½“Hook (0 = å…³é—­, 1 = å¼€å¯)
Enable=1

; å­—ä½“æ–‡ä»¶åï¼ˆå¿…é¡»æ”¾åœ¨æ¸¸æˆæ ¹ç›®å½•æˆ–é‡å®šå‘æ–‡ä»¶å¤¹å†…ï¼‰
; è‹¥ç•™ç©ºåˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“
FileName=galgame_cnjp.ttf

; å­—ä½“åç§°ï¼ˆCreateFont ä¸­çš„ FaceNameï¼‰
; å»ºè®®ä¸ FileName ä¸­çš„å­—ä½“å†…åç§°ä¿æŒä¸€è‡´
FaceName=galgame

; å­—ä½“å­—ç¬¦é›† (128 = Shift-JIS, 134 = GB2312, 1 = Default)
; å¦‚æœæ±‰åŒ–åå‡ºç°ä¹±ç å°è¯•æ”¹ä¸º 134 æˆ– 1
Charset=128

; æ˜¯å¦å¯ç”¨å­—ä½“åç§°æ›¿æ¢ (0 = å…³é—­, 1 = å¼€å¯)
; è®¾ä¸º0æ—¶ä¸ä¼šå°†å­—ä½“åæ›¿æ¢ä¸º FaceName æŒ‡å®šçš„å­—ä½“
EnableFaceNameReplace=1

; æ˜¯å¦å¯ç”¨å­—ç¬¦é›†æ›¿æ¢ (0 = å…³é—­, 1 = å¼€å¯)
; è®¾ä¸º0æ—¶ä¸ä¼šä¿®æ”¹åŸå§‹å­—ç¬¦é›†
EnableCharsetReplace=1

; æ˜¯å¦å¯ç”¨å­—ä½“é«˜åº¦ç¼©æ”¾ (0 = å…³é—­, 1 = å¼€å¯)
EnableHeightScale=1
; å­—ä½“é«˜åº¦ç¼©æ”¾æ¯”ä¾‹ (æ”¯æŒå°æ•°ï¼Œä¾‹å¦‚ 0.9 æˆ– 1.2)
; ç”¨äºä¿®æ­£æ±‰åŒ–åå­—ä½“è¿‡å¤§æˆ–è¿‡å°çš„é—®é¢˜
HeightScale=1.0

; æ˜¯å¦å¯ç”¨å­—ä½“å®½åº¦ç¼©æ”¾ (0 = å…³é—­, 1 = å¼€å¯)
EnableWidthScale=1
; å­—ä½“å®½åº¦ç¼©æ”¾æ¯”ä¾‹ (æ”¯æŒå°æ•°ï¼Œä¾‹å¦‚ 0.8 æˆ– 1.5)
; ç”¨äºè°ƒæ•´å­—ä½“æ¨ªå‘å®½çª„
WidthScale=1.0

; æ˜¯å¦å¯ç”¨å­—ä½“ç²—ç»†è°ƒæ•´ (0 = å…³é—­, 1 = å¼€å¯)
EnableWeight=1
; å­—ä½“ç²—ç»† (0 = é»˜è®¤, 400 = æ ‡å‡†, 700 = ç²—ä½“)
; æ³¨æ„ï¼šè®¾ä¸º0è¡¨ç¤ºä½¿ç”¨ç¨‹åºåŸæœ¬è¯·æ±‚çš„ç²—ç»†
Weight=0

[Window]
; æ˜¯å¦å¯ç”¨çª—å£æ ‡é¢˜ä¿®æ”¹ (0 = å…³é—­, 1 = å¼€å¯)
Enable=1

; è‡ªå®šä¹‰çª—å£æ ‡é¢˜å†…å®¹
Title=æ‰˜æ¯”ä¹‹å¿ƒçµå½’æ¥ã€‚

[FileRedirect]
; æ˜¯å¦å¯ç”¨æ–‡ä»¶é‡å®šå‘ (0 = å…³é—­, 1 = å¼€å¯)
; å¼€å¯åï¼Œæ¸¸æˆè¯»å–æ–‡ä»¶æ—¶ä¼šä¼˜å…ˆä» Folder æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾
Enable=1

; é‡å®šå‘æ–‡ä»¶å¤¹åç§° (é»˜è®¤ä¸º Nepgear)
Folder=Nepgear

; å‹ç¼©åŒ…æ–‡ä»¶åï¼ˆå¦‚æœä½¿ç”¨å‹ç¼©æ¨¡å¼ï¼‰
ArchiveFile=Nepgear.chs

[LocaleEmulator]
; æ˜¯å¦å¯ç”¨åŒºåŸŸæ¨¡æ‹Ÿé›†æˆ (0 = å…³é—­, 1 = å¼€å¯)
; åªæœ‰è®¾ç½®ä¸º 1 æ—¶æ‰ä¼šå°† LoaderDll.dll å’Œ LocaleEmulator.dll è½½å…¥æ¸¸æˆæ ¹ç›®å½•å¹¶æ‰§è¡ŒåŒºåŸŸ
Enable=1

; ä»£ç é¡µ (932 = æ—¥æ–‡ Shift-JIS, 936 = ä¸­æ–‡ GBK)
CodePage=932

; åŒºåŸŸ ID (1041 = æ—¥æœ¬, 2052 = ä¸­å›½)
LocaleID=1041

; å­—ç¬¦é›† ID (128 = Shift-JIS, 134 = GB2312)
Charset=128

; æ—¶åŒºè®¾ç½® (Tokyo Standard Time = ä¸œäº¬æ—¶åŒº, China Standard Time = ä¸­å›½æ ‡å‡†æ—¶é—´)
Timezone=Tokyo Standard Time

[Debug]
; æ˜¯å¦å¼€å¯è°ƒè¯•æ§åˆ¶å° (0 = å…³é—­, 1 = å¼€å¯)
; å¼€å¯åä¼šå¼¹å‡ºä¸€ä¸ª CMD çª—å£æ˜¾ç¤º Hook æ—¶çš„æ—¥å¿—ï¼ˆç”¨äºæ’æŸ¥æ–‡ä»¶åŠ è½½ç­‰ï¼‰
Enable=1
```

### 3. ä½¿ç”¨ Packer æ‰“åŒ…èµ„æº
Nepgear é…å¥—äº†ä¸€ä¸ªç®€å•çš„æ‰“åŒ…å·¥å…· `Packer.exe`ï¼Œç”¨äºå°†ç¿»è¯‘èµ„æºæ‰“åŒ…æˆ `.chs` å•ä¸ªæ–‡ä»¶ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
1.  å°†éœ€è¦æ›¿æ¢çš„æ¸¸æˆèµ„æºï¼ˆå›¾ç‰‡ã€è„šæœ¬ç­‰ï¼‰æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¿æŒåŸæœ‰çš„ç›®å½•ç»“æ„ã€‚
2.  å°†è¯¥æ–‡ä»¶å¤¹ç›´æ¥**æ‹–æ‹½**åˆ° `Packer.exe` å›¾æ ‡ä¸Šã€‚
3.  ç¨‹åºä¼šè‡ªåŠ¨åœ¨åŒçº§ç›®å½•ç”ŸæˆåŒåçš„ `.chs` æ–‡ä»¶ï¼ˆä¾‹å¦‚æ‹–æ‹½ `Nepgear` æ–‡ä»¶å¤¹ -> ç”Ÿæˆ `Nepgear.chs`ï¼‰ã€‚
4.  å°†ç”Ÿæˆçš„ `.chs` æ–‡ä»¶æ”¾å…¥æ¸¸æˆç›®å½•ï¼Œå¹¶åœ¨ `Nepgear.ini` ä¸­é…ç½® `ArchiveFile=xxx.chs`ã€‚
